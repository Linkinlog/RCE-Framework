<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Example - Component & Event Bus</title>
</head>
<body>
    <div id="app"></div> 
    <script type="module">
        import { EventBus, GlobalComponentEvents } from '/component-builder-and-event-bus/EventBus.js';  
        import { Factory, ComponentConfigs, ComponentProps } from '/component-builder-and-event-bus/Factory.js'; 

        (function(
            Factory,
            ComponentConfigs
        ){
            // State of individual modules
            var initialState = {
                componentName : 'exampleComponent', 
                heading : 'Hello World'
            };

            // Return registered module (object) to developer
            ComponentConfigs.exampleComponent = {

                eventBus : [ 'GlobalComponentEvents' ],
                state : initialState, 
                props : {
                    eventListeners : {
                        updateHeading : {
                            onChangeFormInput : {
                                eventInit : ( moduleKey, module ) => {
                                    let inlineTemplateNode = module.get.inlineTemplateNode();  
                                    if(inlineTemplateNode) {
                                        inlineTemplateNode.querySelector( '[data-update-heading]' ).addEventListener( 'keyup', function(event){
                                            module.dispatch.commitHeading( event.target.value );
                                        });
                                    }
                                }
                            }
                        }
                    }
                },
                hooks : {

                    onMount : function( state ) { 
                        this.component().dispatch.insertTemplate( '#app', 'append' ); 
                        this.component().dispatch.updateHeading();
                    }, 
                    onUpdate : function( delta ) {    
                        if( !this.component().get.state( 'firstRenderFlag' ) ) { 
                            let key = this.component().get.state( 'key' );
                            this.component().dispatch.updateHeading( document.querySelector( `[data-key="${key}"]` ) );
                        }
                    }

                },  
                dispatch : {
                    
                    /**
                     * commitHeading
                     * @param inputValue (string)
                     */
                    commitHeading : function( inputValue ) {
                        this.component().commit.state({ 'heading' : inputValue });
                    },

                    /**
                     * updateHeading
                     */
                    updateHeading : function() { 
                        let node = this.component().get.inlineTemplateNode();
                        node.querySelector( '[data-heading]' ).innerHTML = this.component().get.state( 'heading' );
                    },

                },
                template : `
                    <div>
                        <h1 data-heading></h1>
                        <form>
                            <input data-update-heading type="text"/>
                        </form>
                    </div>
                `
            }

            Factory.registerComponent( ComponentConfigs.exampleComponent );

        })(
            Factory,
            ComponentConfigs
        );

    </script>
</body>
</html>